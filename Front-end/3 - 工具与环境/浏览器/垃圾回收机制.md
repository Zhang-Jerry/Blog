
V8 采用的垃圾回收算法 —— 分代回收(Generation GC)

https://juejin.im/post/6844903695721709581#heading-15

## 一. 什么是垃圾

确定不会再被使用的数据，即为垃圾数据。

栈(stack)会自动分配内存空间，会自动释放空间。无需垃圾回收。
堆(heap)动态分配的内存，大小不定也不会自动释放。需要垃圾回收机制来释放内存空间。
**注**：闭包中的变量并不保存在栈内存中，而是保存在堆内存中。这也是闭包能引用到函数内变量的原因。

## 二、 如何回收垃圾

### 1. 标记

V8 采用 **可达性** 算法来判断堆中对象应不应该被回收，判断步骤如下：

* 从根节点出发，遍历所有的对象
* 可以遍历到的对象，标识为可达(reachable)
* 无法遍历到的对象，标识为不可达(unreachable)

浏览器环境下，根节点包括：

* 全局对象 window，位于每个 iframe 中
* 文档 DOM 对象
* 存放在栈中的变量

根节点不是垃圾，不能被回收。

### 2. 清理

标记完成后，统一清理被标识为不可达的对象。

### 3. 内存整理

清理操作后，堆内存中存在大量不连续的空间，称为 内存碎片闭包中的变量并不保存在栈内存中，而是保存在堆内存中。这也是函数之后为什么闭包还能引用到函数内的变量