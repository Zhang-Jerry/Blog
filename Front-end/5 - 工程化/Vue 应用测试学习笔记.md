## 测试介绍

前端应用程序主要编写三种**测试类型**：单元测试、快照测试、端到端测试。

实际开发中，应根据三者各自的优缺点按比例**混合使用**。在一个测试金字塔中，单元测试需要占大部分比例，因为它们在开发应用程序时可以提供快速的反馈。快照测试的覆盖范围比较广，因此我们并不需要太多的快照测试。以Vue组件为例，一个Vue组件可能只需要一个到三个的快照测试用例。端到端测试用例虽然对应用程序非常有用，但由于它可能很慢而且会不稳定，因此端到端测试比例应该是最少的。

**代码覆盖率**是度量一个应用程序或者库质量的一个重要指标，通常而言0%表示未进行任何代码测试，100%意味着在测试用例执行时，每一行代码都被执行过了。对一个完整的应用程序而言，你可能会花费少量的时间就能让测试覆盖率达到80%，然而剩下的20%可能会让你花费数倍的时间来完成，甚至根本达不到。就像你很轻松就能拧干毛巾里面大部分的水，然而拧干剩下的一小部分依然是一件十分困难的事情。

在Vue应用中，对于UI组件来说，我们并不推荐一味的追求行级覆盖率，因为过度注重覆盖率可能会严重导致我们过分关注组件内部的实现细节，从而导致过多的繁琐测试。取而代之的是，我们希望把组件测试撰写为断言组件的公共接口，并在一个黑盒中去处理它，一个简单的UI组件测试用例将断言把一些输入(用户交互或Prop输入等)提供给组件之后，期望组件得到预期的结果(渲染结果或响应事件等)。

#### 端到端测试

站在用户的角度测试

把程序看成一个黑盒子，不关注程序的实现，模拟用户与系统的交互过程，测试系统的响应结果。它是可以自动执行的手动测试。

案例：通过模拟用户操作，测试“计算器”系统的响应结果

    function testCalc (browser) {
      browser.url('http://localhost:8080')
            .click('#button-1')
            .click('#button-plus')
            .click('#button-1')
            .assert.containsText('#result', '2')
            .end();
    }

优点：

* 测试用例易于编写。
* 交互流程易于模拟。

缺点：

* 测试用例运行可能不是很快：启动浏览器会花费几秒、不同网站不同速度又会存在不同的耗时。
* 端到端的调试工作会很困难：在上面的例子中，在本地环境上面进行调试尚且是一个很糟糕的过程，如果测试是在持续集成的服务器上失败，那么更可以说是一场灾难。
* 端到端可能成为flaky测试：flaky测试表示即使被测应用程序正常运行，测试仍然频繁失败，其中失败的原因取决于多种因素：代码执行时间过长或API暂时失效。

#### 单元测试

站在程序员的角度测试

是对应用程序最小的部分运行测试的过程。通常来说，测试的单元是一个函数，但在Vue应用程序中，组件也算是一个被测单元。

案例：测试一个加法函数

    // math.js
    export function add (a, b) {
      return a + b
    }

    // math.spec.js
    import { add } from 'math.js'
    describe('math.js', () => {
      it('add func', () => {
        expect(add(1, 2)).toBe(3)
      })
    })

优点：

* 运行速度快：不同于端到端测试，单元测试用例运行速度很快。
* 友好的应用辅助效果：当团队出现新人时，他可以从单元测试中迅速了解项目需求。

缺点：

* 重构代码困难：如果要将一个已经具备单元测试的复杂功能拆分，需要在更改代码的同时更改对应的单元测试。
* 无法整体测试：由于单元测试只能针对程序的各个单元分开进行测试，各个单元测试通过并不意味着当他们组合起来就一定没有问题。

#### 快照测试

给运行中的应用程序拍一张"照片"，并将其与之前保存的"照片"进行比较，如果二者不相同则测试失败。 


## 